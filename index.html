<!DOCTYPE html>
<html>
<head>
    <title>GGCloud VPN Connector</title>
    <script>
        // Параметры по умолчанию
        const DEFAULT_ROUTING = "https://routing.vpn.ru.com/";
        
        // Получаем параметры из URL
        const params = new URLSearchParams(window.location.search);
        const scheme = params.get('scheme') || 'happ://add/';
        const key = params.get('key');
        const routing = params.get('routing') || DEFAULT_ROUTING;

        // Проверяем обязательные параметры
        if (!key) {
            document.getElementById('error').textContent = 'Отсутствует ключ подписки';
            document.getElementById('error').style.display = 'block';
            throw new Error('Key parameter is required');
        }

        // Формируем URL для редиректа
        const subscriptionUrl = `${scheme}https://bot.ggcloud.ru/connection?scheme=${encodeURIComponent(scheme)}&key=${encodeURIComponent(key)}`;
        
        // Перенаправляем сначала на подписку, затем на роутинг
        window.location.href = subscriptionUrl;
        
        // Открываем роутинг в новой вкладке (если браузер не ушел в приложение)
        setTimeout(() => {
            window.open(routing, '_blank');
        }, 1000);
    </script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 50px; }
        #error { color: red; display: none; margin: 20px 0; }
        .loader { 
            margin: 30px auto;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="loader"></div>
    <p>Идет подключение к GGCloud VPN...</p>
    <div id="error"></div>
    
    <!-- Fallback для браузеров без JS -->
    <noscript>
        <h2>Ошибка: Требуется JavaScript</h2>
        <p>Для работы сервиса необходимо включить JavaScript.</p>
    </noscript>
</body>
</html>